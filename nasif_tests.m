load fove_nasif.mat
%% ORIGINALS
right = [15.76744236, 0.415777189, 0.499881651]; %Line 12, item 9
middle = [10.64356758, 0.254388666, 0.498922082]; %Line 15, item 12
bottom = [7.742494194, 0.255272969, 0.349245457]; %Line 21, item 18

rluv = lupvp2luv(right);
mluv = lupvp2luv(middle);
bluv = lupvp2luv(bottom);

wh = 'd50_31';
rxyz = luv2xyz(rluv, 'WhitePoint', wh);
mxyz = luv2xyz(mluv, 'WhitePoint', wh);
bxyz = luv2xyz(bluv, 'WhitePoint', wh);

% Bottom 2 swapped from here, just readability
rxyzs = rxyz ./ rxyz(2);
mxyzs = mxyz ./ mxyz(2);
bxyzs = bxyz ./ bxyz(2);

rxyy = xyz2xyy(rxyz);
mxyy = xyz2xyy(mxyz);
bxyy = xyz2xyy(bxyz);

rxyys = xyz2xyy(rxyzs);
mxyys = xyz2xyy(mxyzs);
bxyys = xyz2xyy(bxyzs);

rxyz2 = xyy2xyz(rxyy);
mxyz2 = xyy2xyz(mxyy);
bxyz2 = xyy2xyz(bxyy);

rxyzs2 = xyy2xyz(rxyys);
mxyzs2 = xyy2xyz(mxyys);
bxyzs2 = xyy2xyz(bxyys);
% Doesn't matter, scaling linear

[rrgb] = xyz2rgb(rxyz2);
[rrgb] = xyz2rgb(mxyz2);
[brgb] = xyz2rgb(bxyz2);

% As measured?
recr = [9.85502529144287	0.373576134443283	0.351899176836014];
recm = [10.2687168121338	0.328778564929962	0.269892752170563];
recb = [6.43731498718262	0.285101860761642	0.135920122265816];

[rluv2, right2] = xyz2luv(rxyz2);
[mluv2, middle2] = xyz2luv(mxyz2);
[bluv2, bottom2] = xyz2luv(bxyz2);

[rluv2s, right2s] = xyz2luv(rxyzs2, 'WhitePoint', wh);
[mluv2s, middle2s] = xyz2luv(mxyzs2, 'WhitePoint', wh);
[bluv2s, bottom2s] = xyz2luv(bxyzs2, 'WhitePoint', wh);
% Scaled is out of -100...100 range, rec not scaling

%% Plotting
figure
hold on

ct = 21;
%markerColors = repmat(linspace(0, 1, ct), [3 1])';
markerColors = rand(ct, 3);

orig = [0.254388666	0.498922082
0.274562232	0.499042028
0.294735797	0.499161974
0.314909363	0.49928192
0.335082928	0.499401866
0.355256493	0.499521812
0.375430059	0.499641759
0.395603624	0.499761705
0.415777189	0.499881651
0.254388666	0.498922082
0.180799668	0.513106413
0.254388666	0.498922082
0.25453605	0.473975978
0.254683434	0.449029874
0.254830818	0.42408377
0.254978202	0.399137666
0.255125586	0.374191561
0.255272969	0.349245457
0.255420353	0.324299353
0.255567737	0.299353249
0.255715121	0.274407145];

asMeasured = [0.372532099	0.347891361
0.387152493	0.34430325
0.401656449	0.337921709
0.417040229	0.337266445
0.445036054	0.333414525
0.442521542	0.324887663
0.476424009	0.310549229
0.495621711	0.303011775
0.50685513	0.284625232
0.374034315	0.350232124
0.317965835	0.386056155
0.373576134	0.351899177
0.35452953	0.315467089
0.337544084	0.28941676
0.328778565	0.269892752
0.32189554	0.246112302
0.309708804	0.226039305
0.303833783	0.2001037
0.295984685	0.180514872
0.293911606	0.172252655
0.285101861	0.135920122];


for i = 1:ct
    plot(orig(i,1), orig(i,2),'o')
    plot(asMeasured(i,1), asMeasured(i,2),'o', 'MarkerSize', 10)
end

%ax = axes;
colororder(markerColors)




%% AGAIN
clear
load fove_nasif.mat
Luv = [16.09236668	11.82862536	6.398262529
13.58324422	13.54659778	5.421825503
15.74345651	19.82980336	6.30863468
13.92934418	21.19788195	5.603413174
9.037526664	16.12359043	3.649654311
16.77657382	34.33036399	6.801099022
10.67837337	24.65192015	4.34558454
10.41325819	26.77082257	4.253932781
15.76744236	44.67068617	6.465763216
11.22300796	8.249424041	4.462224402
12.68896133	-2.812016549	7.38487933
10.64356758	7.823508865	4.231841156
12.44351363	9.17039319	0.912069312
13.81160221	10.20508502	-3.466747865
11.42069661	8.460380128	-6.570348888
10.47168411	7.777421307	-9.420340529
11.5478377	8.598816576	-14.13340612
7.742494194	5.780094511	-11.98692956
7.85774274	5.881187725	-14.71361824
16.30900983	12.23785123	-35.82761176
10.16944481	7.650367991	-25.63816761];

ch = [0.254388666	0.498922082
0.274562232	0.499042028
0.294735797	0.499161974
0.314909363	0.49928192
0.335082928	0.499401866
0.355256493	0.499521812
0.375430059	0.499641759
0.395603624	0.499761705
0.415777189	0.499881651
0.254388666	0.498922082
0.180799668	0.513106413
0.254388666	0.498922082
0.25453605	0.473975978
0.254683434	0.449029874
0.254830818	0.42408377
0.254978202	0.399137666
0.255125586	0.374191561
0.255272969	0.349245457
0.255420353	0.324299353
0.255567737	0.299353249
0.255715121	0.274407145];



wh = 'd50_2';
wh2 = 'd65_2';
xyz = luv2xyz(Luv,'WhitePoint', wh);
%xyzy = luv2xyz(Luv);
xyy = xyz2xyy(xyz);
%lms = xyz2lms(xyz);
%srgb = xyz2rgb(xyz);
[srgb] = xyz2srgb(xyz);
% for i = 1:21
%     [srgb(i,:), sf(i,:)] = xyz2srgb(xyz(i,:));
% end
[luv2, ch2] = rgb2luv(srgb,'WhitePoint', wh2);

figure
plot(ch(:,1), ch(:,2), 'o')
hold on
plot(ch2(:,1), ch2(:,2), 'x')